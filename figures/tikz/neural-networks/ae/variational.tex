\documentclass[beamer,crop,tikz]{standalone}

\usepackage{formation}

\begin{document}
  \begin{tikzpicture}[x=2cm]
    % Neurones
    \foreach \y in {1,...,5} {
        \node[input] (I\y) at (0, 3 - \y) {$x_\y$};
    }
    \foreach \y in {1,...,4} {
        \node[hencoder] (H1\y) at (1, 2.5 - \y) {};
    }
    \foreach \y in {1,...,3} {
        \node[hencoder] (mu\y) at (2, 4 - \y) {$\mu_\y$};
    }
    \foreach \y in {1,...,3} {
        \node[hencoder] (sigma\y) at (2, 0 - \y) {$\sigma_\y$};
    }

    \foreach \y in {1,...,3} {
        \node[hencoder] (H2\y) at (3, 2 - \y) {$z_\y$};
    }

    \foreach \y in {1,...,4} {
        \node[hencoder] (H3\y) at (4, 2.5 - \y) {};
    }
    \foreach \y in {1,...,5} {
        \node[output] (O\y) at (5, 3 - \y) {$\hat{x_\y}$};
    }
    % Arrows
    \foreach \i in {1,...,5} {
        \foreach \j in {1,...,4} {
        \draw[->,>=stealth] (I\i.east) to (H1\j.west);
        }
    }
    \foreach \i in {1,...,4} {
        \foreach \j in {1,...,3} {
        \draw[->,>=stealth] (H1\i.east) to (mu\j.west);
        }
    }
    \foreach \i in {1,...,4} {
        \foreach \j in {1,...,3} {
        \draw[->,>=stealth] (H1\i.east) to (sigma\j.west);
        }
    }
    \foreach \i in {1,...,3} {
        \foreach \j in {1,...,4} {
        \draw[->,>=stealth] (H2\i.east) to (H3\j.west);
        }
    }
    \foreach \i in {1,...,4} {
        \foreach \j in {1,...,5} {
        \draw[->,>=stealth] (H3\i.east) to (O\j.west);
        }
    }
    % Boxes
    \draw[very thick,dashed,DeepSpaceSparkle] ($(mu1.north west) + (-0.1,0.1)$) rectangle ($(mu3.south east) + (0.1,-0.1)$);
    \draw[very thick,dashed,DeepSpaceSparkle] ($(sigma1.north west) + (-0.1,0.1)$) rectangle ($(sigma3.south east) + (0.1,-0.1)$);
    \draw[very thick,dashed,DeepSpaceSparkle] ($(H21.north west) + (-0.1,0.1)$) rectangle ($(H23.south east) + (+0.1,-0.1)$);


    \draw[->,very thick,>=stealth,DeepSpaceSparkle] ($(mu3.south)+(0,-0.1)$) -- ($(H22.west)+(-0.4,0)$) --  ($(H22.west)+(-0.1,0)$);
    \draw[->,very thick,>=stealth,DeepSpaceSparkle] ($(sigma1.north)+(0,0.1)$) -- ($(H22.west)+(-0.4,0)$) --  ($(H22.west)+(-0.1,0)$);
    %\draw [ArrowC1] (h -| ibox3)++(-0.5,0) -| (ibox3);

    % Text above
    \node at (1, 3) {\textcolor{DeepSpaceSparkle}{\textbf{Moyennes}}};
    \node at (1, -3) {\textcolor{DeepSpaceSparkle}{\textbf{Variances}}};
    \node at (3, -1.8) {\textcolor{DeepSpaceSparkle}{\textbf{Code généré}}};
  \end{tikzpicture}
\end{document}
