\begin{frame}{Introduction}
  Contrôler son environnement logiciel pour~:
  \begin{itemize}
    \item Rendre son environnement de développement reproductible
    \item Contrôler les dépendances pour la prod
    \item Déployer son environnement facilement sur différents clouds
  \end{itemize}
\end{frame}

\begin{frame}{Isolation de l'environnement --- \texttt{venv}}
  \texttt{venv} permet d'isoler un environnement Python~:
  \begin{itemize}
    \item N'intéragit pas avec l'environnement système
    \item Permet la cohabitation de plusieurs environnements incompatibles
    \item Plus rapide et natif que les solutions basées sur les conteneurs
    \item Copie d'une distribution Python de base + customisation
  \end{itemize}
\end{frame}

\begin{frame}{Utilisation de \texttt{venv}}
  \mintedcustomcode{python/production/environment/venv}{console}
\end{frame}

\begin{frame}{Contrôle des dépendances}
  But~: décrire précisément quelles libraires (et leur version) sont utilisées.

  Plusieurs bons outils~:

  \begin{description}
    \item[\texttt{pip} + \texttt{setup.py}] Outil traditionnel, définit un paquet Python
    \item[\texttt{pip} + \texttt{requirements.txt}] Liste simple de dépendances
    \item[\texttt{pip} + \texttt{pip-compile}] Lister les dépendances puis les geler pour la stabilité
    \item[\texttt{Pipenv}] Définition moderne d'une \textbf{application} Python (pas librairie)
    \item[\texttt{poetry}] Définition moderne d'application ou librairie
  \end{description}
\end{frame}

\begin{frame}{Utilisation de \texttt{poetry}}
  Quelques \bluelink{https://python-poetry.org/docs/cli/}{commandes} utiles pour la gestion de dépendances~:
  \begin{description}
    \item[\texttt{poetry new}] Crée un squelette de paquet Python géré par \texttt{poetry}
    \item[\texttt{poetry add}] Ajoute un paquet comme dépendance du projet
    \item[\texttt{poetry remove}] Enlève un paquet comme dépendance du projet
    \item[\texttt{poetry install}] Installe les dépendances telles que spécifiées dans le fichier \texttt{poetry.lock} (géré automatiquement par \texttt{poetry})
    \item[\texttt{poetry export}] Exporte le fichier \texttt{pyproject.toml} vers d'autres formats (comme \texttt{requirements.txt})
  \end{description}
\end{frame}

\begin{frame}{Faciliter le déploiement}
  Quelques plate-formes minoritaires acceptent les paquets Python pour le déploiement.

  Le plus souvent, une étape intermédiaire est nécessaire avant le déploiement, la transformation en conteneur~:

  \begin{itemize}
    \item Permet de contrôler les librairies natives en plus des librairies Python
    \item Plus grande robustesse si le logiciel s'exécute sur plusieurs OS
    \item Plus lourd à mettre en place que \texttt{venv}
    \item Plus adapté pour la prod (déploiement facile par Kubernetes)
  \end{itemize}

  $\Rightarrow$ Dockerisation du paquet Python à l'aide d'un fichier \texttt{Dockerfile}
\end{frame}

\begin{frame}{Exemple de \texttt{Dockerfile}}
  \mintedcustomcode{python/production/environment/Dockerfile}{docker}
\end{frame}
