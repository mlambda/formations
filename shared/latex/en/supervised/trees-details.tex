\begin{frame}{Split quality evaluation}
  Depending on the task:
  \begin{description}
  \item[Régression] Cost using the mean value of the leaf samples:
    \[
      \text{Loss} = \sum|\overline{y}-y| \approx variance
    \]
  \item[Classification] Shannon's entropy :
    \[
      \text{Loss} = -\sum_{x \in X}P_x\log_2(P_x)
    \]
    \begin{itemize}
      \item Minimal when there is no uncertainty
      \item Maximum when uncertainty is maximale (uniform distribution)
    \end{itemize}
  \end{description}
\end{frame}

\begin{frame}{Example — Start}
  \begin{columns}
    \begin{column}{.5\textwidth}
      ID, gardening, video games, hat, age
      \[
        \begin{bmatrix}
          1 & 0 & 1 & 1 & 13  \\
          2 & 0 & 1 & 0 & 14 \\
          3 & 0 & 1 & 0 & 15 \\
          4 & 1 & 1 & 1 & 25 \\
          5 & 0 & 1 & 1 & 35 \\
          6 & 1 & 0 & 0 & 49 \\
          7 & 1 & 1 & 1 & 68 \\
          8 & 1 & 0 & 0 & 71 \\
          9 & 1 & 0 & 1 & 73 \\
        \end{bmatrix}
      \]
    \end{column}
    \begin{column}{.5\textwidth}
      Step 1: Create the first node
      \\[1cm]
      \begin{forest}
        [{1, 2, 3, 4, 5, 6, 7, 8, 9} [{}]]
      \end{forest}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Example — Test to split on gardening}
  \begin{columns}
    \begin{column}{.5\textwidth}
      ID, gardening, video games, hat, age
      \[
        \begin{bmatrix}
          1 & 0 & 1 & 1 & 13  \\
          2 & 0 & 1 & 0 & 14 \\
          3 & 0 & 1 & 0 & 15 \\
          4 & 1 & 1 & 1 & 25 \\
          5 & 0 & 1 & 1 & 35 \\
          6 & 1 & 0 & 0 & 49 \\
          7 & 1 & 1 & 1 & 68 \\
          8 & 1 & 0 & 0 & 71 \\
          9 & 1 & 0 & 1 & 73 \\
        \end{bmatrix}
      \]
    \end{column}
    \begin{column}{.5\textwidth}
      First node split. We need to test the 3 possible splits. Split on gardening:
      \\[1cm]
      \begin{forest}
        [{1, 2, 3, 4, 5, 6, 7, 8, 9}
          [{4, 6, 7, 8, 9},
          edge label={node[midway,left,font=\scriptsize]{gardening}}
            [{$\overline{y} = 57,2$} [{$E = 80,8$}]]]
          [{1, 2, 3, 5},
          edge label={node[midway,right,font=\scriptsize]{$\neg$ gardening}}
            [{$\overline{y} = 19,25$} [{$E = 31,5$}]]]
        ]
      \end{forest}\\
      Total loss: $112,3$
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Example — Test to split on video games}
  \begin{columns}
    \begin{column}{.5\textwidth}
      ID, gardening, video games, hat, age
      \[
        \begin{bmatrix}
          1 & 0 & 1 & 1 & 13  \\
          2 & 0 & 1 & 0 & 14 \\
          3 & 0 & 1 & 0 & 15 \\
          4 & 1 & 1 & 1 & 25 \\
          5 & 0 & 1 & 1 & 35 \\
          6 & 1 & 0 & 0 & 49 \\
          7 & 1 & 1 & 1 & 68 \\
          8 & 1 & 0 & 0 & 71 \\
          9 & 1 & 0 & 1 & 73 \\
        \end{bmatrix}
      \]
    \end{column}
    \begin{column}{.5\textwidth}
      First node split. We need to test the 3 possible splits. Split on video games:
      \\[1cm]
      \begin{forest}
        [{1, 2, 3, 4, 5, 6, 7, 8, 9}
          [{1, 2, 3, 4, 5, 7},%
          edge label={node[midway,left,font=\scriptsize]{video games}}
            [{$\overline{y} = 28,3$} [{$E = 92,6$}]]]
          [{6, 8, 9},
          edge label={node[midway,right,font=\scriptsize]{$\neg$ video games}}
            [{$\overline{y} = 64,3$} [{$E = 30,7$}]]]
        ]
      \end{forest}\\
      Total loss: $123,3$
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Example — Test to split on hat}
  \begin{columns}
    \begin{column}{.5\textwidth}
      ID, gardening, video games, hat, age
      \[
        \begin{bmatrix}
          1 & 0 & 1 & 1 & 13  \\
          2 & 0 & 1 & 0 & 14 \\
          3 & 0 & 1 & 0 & 15 \\
          4 & 1 & 1 & 1 & 25 \\
          5 & 0 & 1 & 1 & 35 \\
          6 & 1 & 0 & 0 & 49 \\
          7 & 1 & 1 & 1 & 68 \\
          8 & 1 & 0 & 0 & 71 \\
          9 & 1 & 0 & 1 & 73 \\
        \end{bmatrix}
      \]
    \end{column}
    \begin{column}{.5\textwidth}
      First node split. We need to test the 3 possible splits. Split on hat:
      \\[1cm]
      \begin{forest}
        [{1, 2, 3, 4, 5, 6, 7, 8, 9}
          [{1, 4, 5, 7, 9},%
          edge label={node[midway,left,font=\scriptsize]{hat}}
            [{$\overline{y} = 42,8$} [{$E = 110,8$}]]]
          [{2, 3, 6, 8},
          edge label={node[midway,right,font=\scriptsize]{$\neg$ hat}}
            [{$\overline{y} = 37,25$} [{$E = 91$}]]]
        ]
      \end{forest}\\
      Total loss: $201,8$
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Example — Select the best split}
  \begin{columns}
    \begin{column}{.5\textwidth}
      ID, gardening, video games, hat, age
      \[
        \begin{bmatrix}
          1 & 0 & 1 & 1 & 13  \\
          2 & 0 & 1 & 0 & 14 \\
          3 & 0 & 1 & 0 & 15 \\
          4 & 1 & 1 & 1 & 25 \\
          5 & 0 & 1 & 1 & 35 \\
          6 & 1 & 0 & 0 & 49 \\
          7 & 1 & 1 & 1 & 68 \\
          8 & 1 & 0 & 0 & 71 \\
          9 & 1 & 0 & 1 & 73 \\
        \end{bmatrix}
      \]
    \end{column}
    \begin{column}{.5\textwidth}
      \begin{description}
        \item[112,3] gardening
        \item[123,3] video games
        \item[201,8] hat
      \end{description}
      → gardening will be used for spliting
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Example — split}
  \begin{columns}
    \begin{column}{.5\textwidth}
      ID, gardening, video games, hat, age
      \[
        \begin{bmatrix}
          1 & 0 & 1 & 1 & 13  \\
          2 & 0 & 1 & 0 & 14 \\
          3 & 0 & 1 & 0 & 15 \\
          4 & 1 & 1 & 1 & 25 \\
          5 & 0 & 1 & 1 & 35 \\
          6 & 1 & 0 & 0 & 49 \\
          7 & 1 & 1 & 1 & 68 \\
          8 & 1 & 0 & 0 & 71 \\
          9 & 1 & 0 & 1 & 73 \\
        \end{bmatrix}
      \]
    \end{column}
    \begin{column}{.5\textwidth}
      Result after the first split:\\[1cm]

      \begin{forest}
        [{1, 2, 3, 4, 5, 6, 7, 8, 9}
          [{4, 6, 7, 8, 9},
          edge label={node[midway,left,font=\scriptsize]{gardening}}]
          [{1, 2, 3, 5},
          edge label={node[midway,right,font=\scriptsize]{$\neg$ gardening}}]
        ]
      \end{forest}\\[1cm]

      Now it's your turn!
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Limit overfiting}
  overfiting can be managed using specific:
  \begin{itemize}
    \item Maximum depth
    \item Minimum number of instances in each leaf
    \item Minumum entropy drop at each split
    \item Minimum number of instances for split
    \item Pruning
  \end{itemize}
\end{frame}
