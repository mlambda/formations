\NeedsTeXFormat{LaTeX2e}

\ProvidesPackage{formation}[2017/12/01 LaTeX class for my formations]

\usepackage{setspace}
\usepackage[export]{adjustbox}
\usepackage{xparse}
\usepackage{ifthen}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{etoolbox}
\usepackage{multicol}
\usepackage{minted}
\usepackage{graphicx}
\usepackage[numbers]{natbib}
\usepackage{forest}
\usepackage{bm}
\usepackage{soulutf8}
\usepackage{stmaryrd}
\usepackage{caption}
\usepackage{tikz}
\usepackage[french]{babel}

\AtBeginEnvironment{quote}{\singlespacing\small}

\DeclareGraphicsExtensions{.pdf,.png,.jpg,.jpeg}
\graphicspath{{./img/}{./tikz/pdf/}}

\usetheme[block=fill,sectionpage=progressbar,subsectionpage=progressbar,progressbar=frametitle]{metropolis}
\setlength{\metropolis@progressinheadfoot@linewidth}{1pt}
\setbeamercolor{normal text}{bg=white}
\setbeamertemplate{bibliography item}{\insertbiblabel}
\setbeamertemplate{blocks}[rounded]
\setbeamercovered{transparent}

\captionsetup[figure]{labelformat=empty}

\makeatletter
\setlength{\metropolis@frametitle@padding}{1.9ex}% <- default 2.2 ex
\renewcommand{\metropolis@frametitlestrut@start}{%
  \rule{0pt}{\metropolis@frametitle@padding}%
}
\renewcommand{\metropolis@frametitlestrut@end}{%
  \rule[-\metropolis@frametitle@padding]{0pt}{\metropolis@frametitle@padding}%
}
\setbeamertemplate{frametitle}{%
    \nointerlineskip%
    \begin{beamercolorbox}[%
        wd=\paperwidth,%
        sep=0pt,%
        leftskip=\metropolis@frametitle@padding,%
        rightskip=\metropolis@frametitle@padding,%
        ]{frametitle}%
        \metropolis@frametitlestrut@start%
        \ifdefempty{\insertsectionhead}{}{%
          {%
            \scriptsize%
            \insertsectionhead%
            \ifdefempty{\insertsubsectionhead}{}{ --- \insertsubsectionhead}%
            \newline%
          }%
        }%
        \insertframetitle%
        \nolinebreak%
        \metropolis@frametitlestrut@end%
    \end{beamercolorbox}
    \usebeamertemplate*{progress bar in head/foot}
}

\bibliographystyle{abbrv}

\newcommand{\partiald}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\card}[1]{\lvert #1 \rvert}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator{\mean}{mean}
\DeclareMathOperator{\ReLU}{ReLU}
\DeclareMathOperator{\softmax}{softmax}
\DeclareMathOperator{\cov}{cov}
\DeclareMathOperator{\corr}{corr}
\DeclareMathOperator{\asym}{asym}
\DeclareMathOperator{\kurt}{kurt}
\DeclareMathOperator{\RNN}{RNN}
\DeclareMathOperator{\EC}{EC}
\DeclareMathOperator{\ECB}{ECB}
\DeclareMathOperator{\BCE}{BCE}
\DeclareMathOperator{\l1}{L1}
\DeclareMathOperator{\L2}{L2}
\DeclareMathOperator{\similarity}{sim}

\makeatletter
\let\UL\ul
\renewcommand\ul{%
  \let\set@color\beamerorig@set@color
  \let\reset@color\beamerorig@reset@color
  \UL}
\makeatother

\newcommand{\newlinebar}{%
  \noindent\makebox[\linewidth]{\rule{\paperwidth}{0.4pt}}\\%
}

\newcommand{\bluelink}[2]{%
  \href{%
    #1%
  }{%
    \color{blue}%
    \setulcolor{blue}%
    \ul{#2}%
  }%
}

\newcommand{\vect}[1]{\bm{\mathbf{#1}}}

\newcommand{\figurecaption}[1]{{\scriptsize\textcolor{gray}{#1}}}

\NewDocumentCommand\imgtw{ o m m }{%
  \begin{figure}%
    \centering%
    \includegraphics[width=#3\textwidth]{#2}%
    \IfNoValueF{#1}{\caption{\figurecaption{#1}}}%
  \end{figure}%
}

\NewDocumentCommand\imgth{ o m m }{%
  \begin{figure}%
    \centering%
    \includegraphics[height=#3\textheight]{#2}%
    \IfNoValueF{#1}{\caption{\figurecaption{#1}}}%
  \end{figure}%
}

\NewDocumentCommand\imgcmw{ o m m }{%
  \begin{figure}%
    \centering%
    \includegraphics[width=#3cm]{#2}%
    \IfNoValueF{#1}{\caption{\figurecaption{#1}}}%
  \end{figure}%
}

\NewDocumentCommand\imgcmh{ o m m }{%
  \begin{figure}%
    \centering%
    \includegraphics[height=#3cm]{#2}%
    \IfNoValueF{#1}{\caption{\figurecaption{#1}}}%
  \end{figure}%
}

\NewDocumentCommand\img{ o m }{%
  \begin{figure}%
    \centering%
    \includegraphics{#2}%
    \IfNoValueF{#1}{\caption{\figurecaption{#1}}}%
  \end{figure}%
}

\NewDocumentCommand\imgtwl{ o m m }{%
  \begin{figure}%
    \centering%
    \includegraphics[width=#3\textwidth,left]{#2}%
    \IfNoValueF{#1}{\caption{\figurecaption{#1}}}%
  \end{figure}%
}

\newcommand{\mintedcustom}[3]{%
  \inputminted[fontsize=\scriptsize,bgcolor=pythonbg,framesep=1mm]{#2}{code/#1.#2}%
  \vspace{-1cm}%
  \inputminted[fontsize=\scriptsize,bgcolor=returnbg,framesep=1mm]{#3}{code/#1.#3}%
}

\newcommand{\mintedcustomcode}[2]{%
  \inputminted[fontsize=\scriptsize,bgcolor=pythonbg,framesep=1mm]{#2}{code/#1.#2}%
  \vspace{-1cm}%
}

\newcommand{\mintedpy}[1]{%
  \inputminted[fontsize=\scriptsize,bgcolor=pythonbg,framesep=1mm]{python}{code/#1.py}%
  \vspace{-1cm}%
  \inputminted[fontsize=\scriptsize,bgcolor=returnbg,framesep=1mm]{python}{code/#1.output}%
}

\newcommand{\mintedpycode}[1]{%
  \inputminted[fontsize=\scriptsize,bgcolor=pythonbg,framesep=1mm]{python}{code/#1.py}%
  \vspace{-1cm}%
}

\definecolor{pythonbg}{rgb}{0.9,1,0.95}
\definecolor{returnbg}{rgb}{0.88,0.88,0.88}

\newcommand{\tw}{\textwidth}

% Color definitions

% https://coolors.co/335c67-fff3b0-e09f3e-9e2a2b-540b0e
\definecolor{DeepSpaceSparkle}{HTML}{335C67}
\definecolor{MediumChampagne}{HTML}{FFF3B0}
\definecolor{IndianYellow}{HTML}{E09F3E}
\definecolor{Auburn}{HTML}{9E2A2B}
\definecolor{Rosewood}{HTML}{540B0E}

\newcommand{\green}[1]{\textcolor{OliveGreen}{#1}}
\newcommand{\red}[1]{\textcolor{BrickRed}{#1}}
\newcommand{\blue}[1]{\textcolor{NavyBlue}{#1}}
\newcommand\gray[1]{\textcolor{gray}{#1}}
\newcommand\purple[1]{\textcolor{purple}{#1}}
\newcommand\smallgray[1]{\textcolor{gray}{\footnotesize\it #1}}

\DeclareDocumentCommand\question{ m o }{%
  {\alert{#1}%
    \ifnum\value{beamerpauses}=1
      \setcounter{beamerpauses}{2}
    \fi
    \IfNoValueF{#2}{ \visible<+->{#2}}%
  }%
}

\newcommand{\mog}[2][]{%
  \ifthenelse{\equal{\Trainer}{mog}}
    {#2}
    {#1}%
}

\newcommand{\fmg}[2][]{%
  \ifthenelse{\equal{\Trainer}{fmg}}
    {#2}
    {#1}%
}

% Tikz stuff

\usetikzlibrary{datavisualization}
\usetikzlibrary{datavisualization.formats.functions}

\tikzset{hencoder/.style={
  minimum width=1cm,
  minimum height=0.7cm,
  rectangle,
  rounded corners=3pt,
  fill=Auburn,
  text=white,
  line width=0.5mm,
  draw=Auburn!50}}
\tikzset{hdecoder/.style={
  hencoder,
  fill=Rosewood,
  text=white,
  draw=Rosewood!50}}
\tikzset{input/.style={
  hencoder,
  fill=MediumChampagne!50!black,
  text=white,
  draw=MediumChampagne!75!black}}
\tikzset{output/.style={
  hencoder,
  fill=DeepSpaceSparkle,
  text=white,
  draw=DeepSpaceSparkle!50}}
